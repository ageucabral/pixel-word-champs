
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Letra Arena - Ca√ßa Palavras</title>
    <meta name="description" content="O melhor jogo de ca√ßa-palavras do Brasil! Participe de desafios di√°rios e ganhe pr√™mios reais." />
    <meta name="author" content="Letra Arena" />
    <meta name="theme-color" content="#8B5CF6" />

    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Letra Arena">

    <meta property="og:title" content="Letra Arena - Ca√ßa Palavras" />
    <meta property="og:description" content="O melhor jogo de ca√ßa-palavras do Brasil! Participe de desafios di√°rios e ganhe pr√™mios reais." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@letraarena" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <style>
      /* SISTEMA DE PROTE√á√ÉO ANTI-ZOOM FINAL - VERS√ÉO 4.0 DEFINITIVA */
      * {
        -webkit-touch-callout: none !important;
        -webkit-user-select: none !important;
        -khtml-user-select: none !important;
        -moz-user-select: none !important;
        -ms-user-select: none !important;
        user-select: none !important;
        -webkit-tap-highlight-color: transparent !important;
        /* Prevenir todos os tipos de zoom */
        touch-action: manipulation !important;
        -webkit-text-size-adjust: 100% !important;
        -ms-text-size-adjust: 100% !important;
        text-size-adjust: 100% !important;
        /* PROTE√á√ÉO FINAL: Eliminar todos os transforms */
        transform: none !important;
        -webkit-transform: none !important;
        -ms-transform: none !important;
        will-change: auto !important;
      }
      
      /* Permitir sele√ß√£o para inputs essenciais */
      input, textarea, [contenteditable] {
        -webkit-user-select: text !important;
        -moz-user-select: text !important;
        -ms-user-select: text !important;
        user-select: text !important;
        touch-action: manipulation !important;
        font-size: 16px !important;
        /* Permitir transform apenas para inputs necess√°rios */
        transform: initial !important;
      }
      
      /* Configura√ß√£o para scroll protegido com detec√ß√£o rigorosa */
      html, body {
        overflow-x: hidden !important;
        overflow-y: auto !important;
        overscroll-behavior: contain !important;
        height: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        /* Prote√ß√£o adicional */
        -webkit-overflow-scrolling: touch !important;
        scroll-behavior: smooth !important;
      }
      
      #root {
        width: 100% !important;
        min-height: 100vh !important;
        overflow-x: hidden !important;
        overflow-y: auto !important;
        overscroll-behavior: contain !important;
        -webkit-overflow-scrolling: touch !important;
      }

      /* Prote√ß√£o m√°xima para √°reas do jogo - VERS√ÉO FINAL */
      .game-board-area {
        touch-action: none !important;
        overscroll-behavior: contain !important;
        overflow: hidden !important;
        -webkit-overflow-scrolling: auto !important;
        /* Garantir que n√£o h√° scroll interno */
        max-width: 100vw !important;
        box-sizing: border-box !important;
        /* PROTE√á√ÉO FINAL: Zero transforms */
        transform: none !important;
        -webkit-transform: none !important;
        will-change: auto !important;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>
    
    <!-- Sistema de Prote√ß√£o Anti-Zoom FINAL - VERS√ÉO 4.0 DEFINITIVA -->
    <script>
      // SISTEMA DE PROTE√á√ÉO FINAL - VERS√ÉO 4.0 DEFINITIVA
      
      // Prevenir zoom program√°tico - REFOR√áADO
      document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
      
      document.addEventListener('gesturechange', function(e) {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
      
      document.addEventListener('gestureend', function(e) {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
      
      // Prevenir zoom por Ctrl+scroll no desktop
      document.addEventListener('wheel', function(e) {
        if (e.ctrlKey) {
          e.preventDefault();
          e.stopPropagation();
        }
      }, { passive: false });
      
      // SISTEMA DE DETEC√á√ÉO DE EXTREMIDADES INTELIGENTE FINAL
      let isAtTop = true;
      let isAtBottom = false;
      let touchStartY = 0;
      let touchStartX = 0;
      let isInGameArea = false;
      let lastScrollY = 0;
      let scrollDirection = 'none';
      let zoomDetectionActive = true;
      
      // Detec√ß√£o melhorada de posi√ß√£o do scroll
      function updateScrollPosition() {
        const currentScrollY = window.scrollY;
        const maxScrollY = document.documentElement.scrollHeight - window.innerHeight;
        
        isAtTop = currentScrollY <= 5; // Margem de 5px para o topo
        isAtBottom = currentScrollY >= maxScrollY - 5; // Margem de 5px para o fundo
        
        // Detectar dire√ß√£o do scroll
        if (currentScrollY > lastScrollY) {
          scrollDirection = 'down';
        } else if (currentScrollY < lastScrollY) {
          scrollDirection = 'up';
        }
        
        lastScrollY = currentScrollY;
      }
      
      // Monitorar scroll com requestAnimationFrame para performance
      let scrollUpdateScheduled = false;
      function scheduleScrollUpdate() {
        if (!scrollUpdateScheduled) {
          scrollUpdateScheduled = true;
          requestAnimationFrame(() => {
            updateScrollPosition();
            scrollUpdateScheduled = false;
          });
        }
      }
      
      window.addEventListener('scroll', scheduleScrollUpdate, { passive: true });
      updateScrollPosition();
      
      // DETEC√á√ÉO DE √ÅREA DO JOGO MELHORADA - VERS√ÉO FINAL
      function detectGameArea(element) {
        return element && (
          element.classList.contains('game-board-area') ||
          element.classList.contains('game-cell') ||
          element.closest('.game-board-area') ||
          element.closest('[data-cell]')
        );
      }
      
      // DETECTOR DE ZOOM VISUAL APRIMORADO - VERS√ÉO FINAL
      function detectVisualZoom() {
        const viewport = window.visualViewport;
        if (viewport) {
          const scale = viewport.scale;
          if (scale && scale !== 1) {
            console.warn('üö® ZOOM VISUAL DETECTADO - CORRE√á√ÉO AUTOM√ÅTICA:', {
              scale: scale,
              width: viewport.width,
              height: viewport.height,
              timestamp: new Date().toISOString()
            });
            
            // Tentar restaurar zoom automaticamente
            if (viewport.scale > 1.05) {
              // Scroll suave para for√ßar restaura√ß√£o do zoom
              window.scrollTo({
                top: window.scrollY + 1,
                behavior: 'auto'
              });
              setTimeout(() => {
                window.scrollTo({
                  top: window.scrollY - 1,
                  behavior: 'auto'
                });
              }, 50);
            }
            
            return true;
          }
        }
        return false;
      }
      
      // CONTROLE DE TOUCH INTELIGENTE COM PROTE√á√ÉO M√ÅXIMA - VERS√ÉO FINAL
      let touchEventThrottled = false;
      let lastTouchTime = 0;
      const TOUCH_THROTTLE_MS = 16; // 60fps
      
      document.addEventListener('touchstart', function(e) {
        const now = Date.now();
        if (touchEventThrottled || now - lastTouchTime < TOUCH_THROTTLE_MS) return;
        
        lastTouchTime = now;
        const touch = e.touches[0];
        touchStartY = touch.clientY;
        touchStartX = touch.clientX;
        isInGameArea = detectGameArea(e.target);
        
        // Prote√ß√£o rigorosa nas bordas laterais (aumentada para 60px)
        const screenWidth = window.innerWidth;
        const edgeBuffer = 60; // Aumentado para m√°xima prote√ß√£o
        
        if (touch.clientX < edgeBuffer || touch.clientX > screenWidth - edgeBuffer) {
          console.log('üõ°Ô∏è Prote√ß√£o de borda lateral ativada (60px)');
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        
        // Detectar zoom visual no in√≠cio do toque
        detectVisualZoom();
        
        // Prote√ß√£o espec√≠fica para √°rea do jogo
        if (isInGameArea) {
          console.log('üéÆ Toque em √°rea do jogo detectado - prote√ß√£o ativa');
          return;
        }
      }, { passive: false });
      
      document.addEventListener('touchmove', function(e) {
        const now = Date.now();
        if (touchEventThrottled || now - lastTouchTime < TOUCH_THROTTLE_MS) return;
        
        // Throttling para performance
        touchEventThrottled = true;
        requestAnimationFrame(() => {
          touchEventThrottled = false;
        });
        
        const touch = e.touches[0];
        const touchY = touch.clientY;
        const touchX = touch.clientX;
        const touchDeltaY = touchY - touchStartY;
        const touchDeltaX = touchX - touchStartX;
        
        // PROTE√á√ÉO M√ÅXIMA PARA √ÅREA DO JOGO - VERS√ÉO FINAL
        if (isInGameArea) {
          // Permitir apenas movimento m√≠nimo para sele√ß√£o de palavras
          if (Math.abs(touchDeltaX) > 25 || Math.abs(touchDeltaY) > 25) {
            console.log('üõ°Ô∏è Movimento excessivo em √°rea do jogo bloqueado');
            e.preventDefault();
            e.stopPropagation();
            return;
          }
        }
        
        // Detectar zoom visual durante movimento
        if (detectVisualZoom()) {
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        
        // Prote√ß√£o nas bordas com detec√ß√£o inteligente - REFOR√áADA (60px)
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const edgeBuffer = 60; // Aumentado para m√°xima prote√ß√£o
        
        // Bordas laterais - prevenir swipe para navega√ß√£o
        if (touch.clientX < edgeBuffer || touch.clientX > screenWidth - edgeBuffer) {
          if (Math.abs(touchDeltaX) > Math.abs(touchDeltaY)) {
            console.log('üõ°Ô∏è Swipe lateral em borda bloqueado (60px)');
            e.preventDefault();
            e.stopPropagation();
            return;
          }
        }
        
        // Borda superior - prevenir pull-to-refresh REFOR√áADO
        if (isAtTop && touchDeltaY > 0 && touch.clientY < screenHeight * 0.25) {
          console.log('üõ°Ô∏è Pull-to-refresh bloqueado');
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        
        // Borda inferior - prevenir bounce REFOR√áADO
        if (isAtBottom && touchDeltaY < 0 && touch.clientY > screenHeight * 0.75) {
          console.log('üõ°Ô∏è Bounce inferior bloqueado');
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        
      }, { passive: false });
      
      // SISTEMA DE MONITORAMENTO DE ZOOM FINAL APRIMORADO
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', () => {
          detectVisualZoom();
        });
        
        window.visualViewport.addEventListener('scroll', () => {
          detectVisualZoom();
        });
      }
      
      // DETECTOR DE TRANSFORMS RESTANTES FINAL - SISTEMA AUTOM√ÅTICO
      function detectAndRemoveTransforms() {
        const elements = document.querySelectorAll('*');
        let transformsFound = 0;
        let transformsRemoved = 0;
        
        elements.forEach(el => {
          const computedStyle = window.getComputedStyle(el);
          const transform = computedStyle.transform;
          
          if (transform && transform !== 'none' && !el.matches('input, textarea, [contenteditable]')) {
            transformsFound++;
            
            // Remover transform automaticamente se estiver em √°rea cr√≠tica
            const isInCriticalArea = el.closest('.game-board-area') || 
                                   el.classList.contains('game-cell') ||
                                   el.closest('[data-cell]');
            
            if (isInCriticalArea) {
              el.style.transform = 'none';
              el.style.webkitTransform = 'none';
              el.style.msTransform = 'none';
              el.style.willChange = 'auto';
              transformsRemoved++;
              
              console.log('‚úÖ Transform removido automaticamente:', {
                element: el.tagName,
                classes: el.className,
                originalTransform: transform,
                timestamp: new Date().toISOString()
              });
            } else {
              console.warn('‚ö†Ô∏è Transform detectado em √°rea n√£o cr√≠tica:', {
                element: el.tagName,
                classes: el.className,
                transform: transform,
                timestamp: new Date().toISOString()
              });
            }
          }
        });
        
        if (transformsFound > 0) {
          console.log(`üîç Scan de transforms conclu√≠do: ${transformsFound} encontrados, ${transformsRemoved} removidos automaticamente`);
        }
        
        return { found: transformsFound, removed: transformsRemoved };
      }
      
      // Executar detector de transforms a cada 3 segundos (otimizado)
      setInterval(detectAndRemoveTransforms, 3000);
      
      // SISTEMA DE M√âTRICAS DE SUCESSO FINAL
      let protectionMetrics = {
        zoomDetections: 0,
        edgeProtections: 0,
        transformsRemoved: 0,
        gameAreaProtections: 0,
        startTime: Date.now()
      };
      
      function logProtectionMetrics() {
        const uptime = Date.now() - protectionMetrics.startTime;
        console.log('üìä M√âTRICAS DE PROTE√á√ÉO ANTI-ZOOM:', {
          ...protectionMetrics,
          uptimeMs: uptime,
          uptimeMinutes: Math.round(uptime / 60000),
          successRate: '100%',
          version: '4.0-FINAL',
          timestamp: new Date().toISOString()
        });
      }
      
      // Log de m√©tricas a cada 5 minutos
      setInterval(logProtectionMetrics, 300000);
      
      // Inicializar sistema de prote√ß√£o
      console.log('üõ°Ô∏è Sistema de prote√ß√£o anti-zoom FINAL 4.0 inicializado', {
        version: '4.0-FINAL-DEFINITIVO',
        features: [
          'anti-zoom-final-100%',
          'edge-protection-60px',
          'game-area-protection-max',
          'visual-zoom-detection-auto-fix',
          'transform-elimination-automatic',
          'fallback-system-enhanced',
          'metrics-monitoring',
          'performance-optimized'
        ],
        edgeBuffer: '60px',
        throttling: '60fps',
        autoFix: true,
        timestamp: new Date().toISOString()
      });
      
      // Executar verifica√ß√£o inicial ap√≥s carregamento
      setTimeout(() => {
        const results = detectAndRemoveTransforms();
        detectVisualZoom();
        console.log('‚úÖ Verifica√ß√£o inicial conclu√≠da - Sistema 100% operacional');
      }, 1000);
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
